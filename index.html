<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" href="https://cdn.glitch.global/deee0fd1-6cbf-4fd4-b0ab-9e576ed71f35/favicon.png?v=1658494414762" />
    <link rel="stylesheet" href="/201-flow-style.css" /> 
    <title>Beginner's Luck - Account Registration</title>

    <script type="text/javascript"
      src="https://pingsandboxsdk.singularkey.com/latest/singularkey.js">
    </script>

    <script>
      function loadwidget() {    
        const skApiBaseUrl = "https://api.singularkey.com/v1";
        const companyId = "5d6c003f-8a59-4c99-a736-4e5a122862dd";
        const skApiKey = "b2f9f9511d52b05ac020054f19212ebcd5a523d9323a34545906afcac4020425e14a030e8c36a497a25def3faf200f1114ef3015ec3697381ed65adcae8235d39887458dc58f31bbf7011e907be4321cc7ff4b5119eaecdfb355a1fc2ef10ae38fb12535754fc2f4dfb444ccb6817125a34c27b5f03968676a1121b2ba4b1d6b";
        const skPolicyId = "06143b60bbeac8b97f052473620e656a";

        const skGetTokenUrl =
          skApiBaseUrl + "/company/" + companyId + "/sdkToken";

        //*** Add the API Key from your DaVinci Application. ***/
        var headers = new Headers();
        headers.append("X-SK-API-KEY", skApiKey);
        headers.append("Content-type", "application/json");

        var requestOptions = {
          method: "GET",
          headers: headers,
          redirect: "follow",
        };

        //*** Retrieve DaVinci Token ***/
        fetch(skGetTokenUrl, requestOptions)
          .then((response) => response.json())
          .then((responseData) => {
            var props = {
              config: {
                method: "runFlow",
                apiRoot: skApiBaseUrl,
                accessToken: responseData.access_token,
                companyId: companyId,
                policyId: skPolicyId,
              },
              useModal: false,
              successCallback,
              errorCallback,
              onCloseModal,
            };
            /*** Invoke DaVinci Widget ****/
            console.log(props);
            singularkey.skRenderScreen(document.getElementById("widget"), props);
          })
          .catch((error) => console.log("error", error));
      }

      function successCallback(response) {
        console.log(response);
      }

      function errorCallback(error) {
        document.getElementById('widget').innerHTML= JSON.stringify(error);
      }

      function onCloseModal() {
        console.log("onCloseModal");
      }
    </script>
  </head>
  
  <body onload="loadwidget()">
    <div id="widget" class="skWidget widget">
      If you're seeing this message, the DaVinci flow hasn't loaded yet. 
    </div>
    <div class="glitch">
      <a class="remix" target="_top" href="https://glitch.com/edit/#!/remix/pingone-davinci-201">
        <img src="https://cdn.glitch.com/605e2a51-d45f-4d87-a285-9410ad350515%2FLogo_Color.svg?v=1618199565140" />
        Remix on Glitch
      </a>
    </div>
    <div class="glitch">
      <a href="index-live.html">Click To See Functional Version</a>
    </div>
  </body>
</html>
